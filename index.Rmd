---
title: "Netflix History"
author: "Patrick Meyer"
date: "7 2 2021"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## R Markdown

This is an R Markdown presentation. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

## Slide with Bullets

- Bullet 1
- Bullet 2
- Bullet 3

## Slide with R Output

```{r cars, echo = TRUE}

library(stringr)
library(aweek)
library(plotly)
library(tidyr)
library(dplyr)
#Import data
netflix = read.csv("NetflixViewingHistory.csv", sep = ";")

#Add zeros because stupid excel screwed up the dates
netflix$Date = as.character(netflix$Date)
netflix$Date = sapply(netflix$Date, FUN = 
                        function(x){if(nchar(x) < 6){x = paste("0", x, sep = "")}
                                      else{x = x}})

#Break the title into 3 seperate columns with "Title of show", "Season", "Title of episode"
netflix = separate(netflix, col = Title, into = c("Title", "Season", "Episode"), sep = ': ')

#Exclude rows which are not in the proper format and are therefore likely now series
netflix = netflix[-which(is.na(netflix$Episode)),]



#Break up the Date-Column in separate columns
netflix$days = substr(netflix$Date, start = 1, stop = 2)
netflix$months = substr(netflix$Date, start = 3, stop = 4)
netflix$years = paste("20", substr(netflix$Date, start = 5, stop = 6), sep = "")
netflix$Date = as.Date(paste(netflix$years, "-", netflix$months, "-", netflix$days, sep = ""))
netflix$week = date2week(netflix$Date)
netflix$week = substr(netflix$week, start = 7, stop = 8)
netflix$weekYear = paste(netflix$years, netflix$week, sep = "-")


netflixTitleCounts = count(netflix, Title)
netflixTitleCounts= netflixTitleCounts[order(netflixTitleCounts$n, decreasing = T),]
netflixTitleCounts$Title = factor(netflixTitleCounts$Title, levels = netflixTitleCounts$Title[order(netflixTitleCounts$n, decreasing = FALSE)])

netflix = netflix[order(netflix$Date),]


#netflix$weeklyViews = 1

#netflix$weeklyViews = numeric(nrow(netflix))
#for (i in 1:nrow(netflix)) {
#  netflix$weeklyViews[i] = sum(netflix$week == netflix$week[i] & netflix$years == netflix$years[i])
#}


```

# Slide with Plot


```{r plot1, warning=FALSE}
p = plot_ly(data = netflixTitleCounts[1:10,], x = ~n, y = ~Title, type = "bar", 
            orientation = "h", marker = list(color = "rgba(229,9,20,1)")) %>%
  layout(yaxis = list(title = list(standoff = 1), color = "white"), 
         xaxis = list(color = "white"), 
         plot_bgcolor = "rgba(0,0,0,1)", 
         paper_bgcolor = "rgba(0,0,0,1)")

p
```

# Slide with Plot


```{r plot2, warning=FALSE,eval=FALSE}
p = plot_ly(data = netflix, x = ~weekYear, y = ~weeklyViews, type = "bar", orientation = "v", color = ~years)
p = p %>% layout(xaxis = list(
                  title = "Week",
                  tickvals = netflix$weekYear,
                  ticktext = substr(netflix$weekYear, start = 6, stop = 7),
                  tickmode = "array"
                  ))
p
```

